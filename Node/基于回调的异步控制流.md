会使用一个实例来展示基于回调的异步控制流。然后逐步改善这个例子。

例子的目的是实现一个网页爬虫。
- 基于命令行
- 输入一个`URL`，输出网页内容到一个本地文件

使用到的库包括：
- `request`：流线型HTTP请求库
- `mkdirp`：递归创建目录库

## callback hell
`金字塔型`代码结构，参照`webSpider`的`spider.js`。

## 如何避免`callback hell`
遵循以下几点可以避免嵌套层次过多：
- 尽可能早的退出。先检查异常情况，碰到异常情况下，及时退出，这样就避免了过多的`if...else`。这样代码的层级就少了
- 为`callback`创建`命名函数`。使用`命名函数`替代闭包，将中间结果作为参数传递。
- 将代码模块化。尽可能将代码切分成小的、可重用的函数。

## 顺序化执行
![sequential](./static/sequential.png)

代码参考`webSpiderV2`，嵌套下载网页中的链接。